(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();const w={apiKey:"",apiEndpoint:"https://vision.googleapis.com/v1/images:annotate",batchSize:5,retryAttempts:3,retryDelay:2e3,rateLimitDelay:1e3};class E{constructor(){this.config={...w},this.loadConfig()}loadConfig(){try{const e=localStorage.getItem("ocrConfig");e&&(this.config={...w,...JSON.parse(e)})}catch(e){console.error("Error loading config:",e)}}saveConfig(){try{localStorage.setItem("ocrConfig",JSON.stringify(this.config))}catch(e){console.error("Error saving config:",e)}}updateConfig(e){this.config={...this.config,...e},this.saveConfig()}get(e){return this.config[e]}}const f=new E;class ${constructor(e){this.configManager=e,this.errors=[],this.retryQueue=[]}addError(e,t){this.errors.push({timestamp:new Date,error:e,page:t,retryCount:0}),this.retryQueue.push(this.errors[this.errors.length-1])}async retryFailed(e){const t=this.configManager.get("retryAttempts"),r=[];for(;this.retryQueue.length>0;){const n=this.retryQueue.shift();if(n.retryCount>=t){r.push({success:!1,page:n.page,error:new Error(`Max retry attempts (${t}) exceeded`)});continue}try{n.retryCount++;const s=await e(n.page);r.push({success:!0,page:n.page})}catch(s){console.error(`Retry failed for page ${n.page.pageNum}:`,s),this.retryQueue.push(n),r.push({success:!1,page:n.page,error:s})}await new Promise(s=>setTimeout(s,this.configManager.get("retryDelay")))}return r}getErrorSummary(){return{total:this.errors.length,retryable:this.retryQueue.length,errors:this.errors.map(e=>({page:e.page.pageNum,message:e.error.message,retries:e.retryCount}))}}}const C="modulepreload",x=function(o){return"/"+o},b={},v=function(e,t,r){if(!t||t.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map(s=>{if(s=x(s),s in b)return;b[s]=!0;const l=s.endsWith(".css"),h=l?'[rel="stylesheet"]':"";if(!!r)for(let a=n.length-1;a>=0;a--){const d=n[a];if(d.href===s&&(!l||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${h}`))return;const i=document.createElement("link");if(i.rel=l?"stylesheet":C,l||(i.as="script",i.crossOrigin=""),i.href=s,document.head.appendChild(i),l)return new Promise((a,d)=>{i.addEventListener("load",a),i.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s})};async function L(){const o=await v(()=>import("./pdf-a7d55f0b.js").then(e=>e.p),["assets/pdf-a7d55f0b.js","assets/_commonjsHelpers-23102255.js"]);return o.GlobalWorkerOptions.workerSrc=`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${o.version}/pdf.worker.min.js`,o}async function D(o,e,t,r){try{const n=await o.arrayBuffer();r.loadedPdf=await e.getDocument({data:n}).promise,console.log("PDF loaded:",r.loadedPdf.numPages,"pages"),t.totalPagesSpan.textContent=r.loadedPdf.numPages,t.processBtn.disabled=!1;const s=parseInt(t.pageLimitInput.value)||r.loadedPdf.numPages;return Math.min(s,r.loadedPdf.numPages)}catch(n){throw console.error("Error loading PDF:",n),t.processBtn.disabled=!0,n}}async function S(o,e){try{const t=await e.getPage(o),r=t.getViewport({scale:2}),n=document.createElement("canvas"),s=n.getContext("2d");return n.height=r.height,n.width=r.width,await t.render({canvasContext:s,viewport:r}).promise,n}catch(t){throw console.error(`Error extracting page ${o}:`,t),t}}class N{constructor(e){this.delay=e,this.lastCall=0}async waitForNext(){const e=Date.now(),t=Math.max(0,this.lastCall+this.delay-e);t>0&&await new Promise(r=>setTimeout(r,t)),this.lastCall=Date.now()}}async function B(o,e=3){let t;for(let r=0;r<e;r++)try{return await o()}catch(n){console.error(`Attempt ${r+1} failed:`,n),t=n,r<e-1&&await new Promise(s=>setTimeout(s,2e3*Math.pow(2,r)))}throw t}const I=new N(1e3);async function F(o){var n;await I.waitForNext();const e=f.get("apiKey");if(!e)throw new Error("Google Cloud Vision API key is not configured. Please set it in the configuration panel.");const t=await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({requests:[{image:{content:o.replace(/^data:image\/(png|jpeg|jpg);base64,/,"")},features:[{type:"TEXT_DETECTION",maxResults:1}]}]})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return((n=(await t.json()).responses[0].textAnnotations[0])==null?void 0:n.description)||""}async function T(o){return B(async()=>await F(o))}function O(o){if(!o)return null;console.log("Raw Vision API text:",o);const e=o.match(/400C[-\s]*(\d+)/i);if(e)return console.log("Found number via 400C pattern:",e[1]),parseInt(e[1]);const t=o.match(/\d{2,}/g);if(t){const r=t.filter(n=>n!=="400").sort((n,s)=>s.length-n.length);if(r.length>0)return console.log("Found number via fallback:",r[0]),parseInt(r[0])}return console.log("No valid number found in text"),null}class R{constructor(e,t){this.updateStatus=e,this.updatePreview=t,this.processed=0,this.total=0,this.errors=[]}async processBatch(e,t){const r=e.slice(t,t+f.get("batchSize"));return await Promise.all(r.map(async(s,l)=>{const h=t+l;try{const g=s.canvas.toDataURL("image/jpeg",.75),i=await T(g);return s.text=i.trim(),s.number=O(s.text),this.processed++,this.updateProgress(),this.updatePreview(h,s),{success:!0,page:s}}catch(g){return this.errors.push({page:s,error:g}),console.error(`Error processing page ${h+1}:`,g),this.processed++,this.updateProgress(),this.updatePreview(h,{...s,text:`Error: ${g.message}`,number:null}),{success:!1,page:s,error:g}}}))}updateProgress(){const e=Math.round(this.processed/this.total*100),t=this.total-this.errors.length;this.updateStatus(`Processing pages: ${this.processed}/${this.total} (${e}%) - Success: ${t} - Errors: ${this.errors.length}`,e)}async processAllPages(e){this.total=e.length,this.processed=0,this.errors=[];for(let t=0;t<e.length;t+=f.get("batchSize"))await this.processBatch(e,t),t+f.get("batchSize")<e.length&&await new Promise(r=>setTimeout(r,1e3));return{success:this.errors.length===0,processed:this.processed,errors:this.errors,successCount:this.total-this.errors.length}}}async function k(o){const{jsPDF:e}=await v(()=>import("./jspdf.es.min-7945b4e9.js").then(r=>r.j),[]),t=new e;for(let r=0;r<o.length;r++){r>0&&t.addPage();const n=o[r].canvas.toDataURL("image/jpeg",.75);t.addImage(n,"JPEG",0,0,t.internal.pageSize.getWidth(),t.internal.pageSize.getHeight())}return t}function M(o,e,t){let r=document.getElementById(`page-${o}`);r||(r=document.createElement("div"),r.id=`page-${o}`,r.className="page-info",t.appendChild(r)),r.innerHTML=`
    <h3>Page ${e.pageNum}</h3>
    <div style="margin-bottom: 10px">
      <strong>Original Page Number:</strong> ${e.pageNum}<br>
      <strong>Extracted Number:</strong> ${e.number!==null?e.number:"Not found"}<br>
      <strong>Status:</strong> ${e.text?"OCR Complete":"Processing"}<br>
      <strong>Time:</strong> ${new Date().toLocaleTimeString()}
    </div>
    ${e.text?`
      <div style="margin-bottom: 10px">
        <strong>Raw OCR Text:</strong>
        <pre style="background: #f5f5f5; padding: 10px; white-space: pre-wrap;">${e.text}</pre>
      </div>
    `:""}
    <div>
      <p><strong>Original Image:</strong></p>
      <img src="${e.canvas.toDataURL()}" alt="Original" style="max-width: 300px;">
    </div>
  `}function j(o,e){const t=document.createElement("div");t.style.padding="20px",t.style.margin="20px 0",t.style.backgroundColor="#f0f0f0";const r=o.filter(s=>s.number!==null).length,n=o.map((s,l)=>`${l+1}. Number: ${s.number||"Not found"} (Original page: ${s.pageNum})`).join(`
`);t.innerHTML=`
    <h2>Processing Summary</h2>
    <p><strong>Total Pages:</strong> ${o.length}</p>
    <p><strong>Numbers Found:</strong> ${r}</p>
    <p><strong>Pages Without Numbers:</strong> ${o.length-r}</p>
    <p><strong>Sort Order:</strong></p>
    <pre style="background: #fff; padding: 10px;">${n}</pre>
  `,e.insertBefore(t,e.firstChild)}class z{constructor(e){this.container=e,this.maxLogs=100}log(e,t="info"){const r=new Date().toLocaleTimeString(),n=document.createElement("div");for(n.className=`log ${t}`,n.innerHTML=`
      <span class="timestamp">[${r}]</span>
      ${this.escapeHtml(e)}
    `,this.container.appendChild(n),this.container.scrollTop=this.container.scrollHeight;this.container.children.length>this.maxLogs;)this.container.removeChild(this.container.firstChild)}info(e){this.log(e,"info")}success(e){this.log(e,"success")}error(e){this.log(e,"error")}clear(){this.container.innerHTML=""}escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}}class A{constructor(){this.logs=[]}log(e,t="info",r=null){const n={timestamp:new Date().toISOString(),type:t,message:e,data:r};return this.logs.push(n),n}info(e,t=null){return this.log(e,"info",t)}success(e,t=null){return this.log(e,"success",t)}error(e,t=null){return this.log(e,"error",t)}generateReport(){return this.logs.map(t=>{let s=`${`[${t.timestamp}] [${t.type.toUpperCase()}]`} ${t.message}`;return t.data&&(s+=`
Data: `+JSON.stringify(t.data,null,2)),s}).join(`

`)}downloadLog(e="ocr-processing-log.txt"){const t=this.generateReport(),r=new Blob([t],{type:"text/plain"}),n=URL.createObjectURL(r),s=document.createElement("a");s.href=n,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)}clear(){this.logs=[]}}document.addEventListener("DOMContentLoaded",()=>{const o={pdfInput:document.getElementById("pdfInput"),pageLimitInput:document.getElementById("pageLimit"),processBtn:document.getElementById("processBtn"),downloadBtn:document.getElementById("downloadBtn"),statusDiv:document.getElementById("status"),preview:document.getElementById("preview"),totalPagesSpan:document.getElementById("totalPages"),progressFill:document.querySelector(".progress-fill"),debugConsole:document.getElementById("debugConsole")},e=new A,t=new z(o.debugConsole),r={loadedPdf:null,processedPages:[],errorRecovery:new $(f)};function n(g){o.progressFill.style.width=`${g}%`}function s(g){console.log("Status:",g),o.statusDiv.textContent=g}function l(){o.pageLimitInput.value="0",o.processBtn.disabled=!0,o.downloadBtn.disabled=!0,o.totalPagesSpan.textContent="-",s("Select a PDF file to begin")}async function h(){const g=await L();l(),t.info("PDF.js initialized successfully"),e.info("Application initialized"),o.pdfInput.addEventListener("change",async i=>{if(i.target.files.length===0){o.processBtn.disabled=!0,o.totalPagesSpan.textContent="-",s("Select a PDF file to begin");return}try{const a=i.target.files[0];t.info(`Loading PDF: ${a.name}`),e.info(`Loading PDF file: ${a.name}`,{fileName:a.name,fileSize:a.size});const d=await D(a,g,o,r);o.processBtn.disabled=!1;const m=`Ready to process ${d} pages`;s(m),t.success(`PDF loaded successfully: ${d} pages`),e.success(m,{totalPages:d})}catch(a){console.error("Error loading PDF:",a),t.error(`Failed to load PDF: ${a.message}`),e.error("Failed to load PDF",{error:a.message,stack:a.stack}),s("Error loading PDF file"),o.processBtn.disabled=!0,o.totalPagesSpan.textContent="-"}}),o.processBtn.addEventListener("click",async()=>{if(!r.loadedPdf)return;o.processBtn.disabled=!0,o.downloadBtn.disabled=!0,o.preview.innerHTML="",n(0),t.clear(),e.clear(),t.info("Starting PDF processing"),e.info("Starting PDF processing",{totalPages:r.loadedPdf.numPages,pageLimit:o.pageLimitInput.value});const i=parseInt(o.pageLimitInput.value)||r.loadedPdf.numPages,a=Math.min(i,r.loadedPdf.numPages);try{r.processedPages=[];for(let c=1;c<=a;c++){t.info(`Extracting page ${c}/${a}`),e.info(`Extracting page ${c}/${a}`);const u=await S(c,r.loadedPdf);r.processedPages.push({pageNum:c,canvas:u,text:null,number:null})}const m=await new R((c,u)=>{s(c),n(u),t.info(c),e.info(c)},(c,u)=>{if(M(c,u,o.preview),u.number!==null){const p=`Page ${u.pageNum}: Extracted number ${u.number}`;t.success(p),e.success(p,{pageNum:u.pageNum,extractedNumber:u.number,rawText:u.text})}else{const p=`Page ${u.pageNum}: Failed to extract number`;t.error(p),e.error(p,{pageNum:u.pageNum,rawText:u.text})}}).processAllPages(r.processedPages),P=r.processedPages.filter(c=>c.number!==null);if(P.length>0){r.processedPages.sort((p,y)=>p.number===null&&y.number===null?0:p.number===null?1:y.number===null?-1:p.number-y.number),j(r.processedPages,o.preview),o.downloadBtn.disabled=!1;const c=m.errors.length>0?`Processing complete with ${m.errors.length} errors. Successfully processed ${P.length} pages.`:`Processing complete! All ${P.length} pages processed successfully.`;s(c+" Click Download to get the reordered PDF."),t.success(c),e.success(c,{totalPages:a,successfulPages:P.length,errors:m.errors.length,pageOrder:r.processedPages.map(p=>({pageNum:p.pageNum,extractedNumber:p.number}))});const u=document.createElement("button");u.className="button",u.style.marginLeft="10px",u.textContent="Download Log",u.onclick=()=>{const p=new Date().toISOString().replace(/[:.]/g,"-");e.downloadLog(`ocr-processing-log-${p}.txt`)},o.downloadBtn.parentNode.appendChild(u)}else{o.downloadBtn.disabled=!0;const c="Processing failed: No valid page numbers were extracted.";s(c),t.error(c),e.error(c)}}catch(d){console.error("Processing error:",d),t.error(`Processing error: ${d.message}`),e.error("Processing error",{error:d.message,stack:d.stack}),s("Error processing PDF: "+d.message),o.processBtn.disabled=!1}}),o.downloadBtn.addEventListener("click",async()=>{try{const i="Generating PDF...";s(i),t.info(i),e.info(i);const a=await k(r.processedPages),d=new Date().toISOString().replace(/[:.]/g,"-");a.save(`reordered-${d}.pdf`);const m="PDF downloaded successfully!";s(m),t.success(m),e.success(m)}catch(i){console.error("Error generating PDF:",i);const a="Error generating PDF: "+i.message;s(a),t.error(a),e.error("PDF generation error",{error:i.message,stack:i.stack})}})}h().catch(g=>{console.error("Initialization error:",g),t.error(`Initialization error: ${g.message}`),e.error("Initialization error",{error:g.message,stack:g.stack})})});export{v as _};
